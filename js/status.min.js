var INFLUXDB_URL="https://db.softver.org.mk/influxdb/query",INFLUXDB_DBNAME="status",noInternetAccess=!1,current_status=document.querySelector("#status"),current_status_time=document.querySelector("#status-time"),current_devices=document.querySelector("#currentDevices");function updateStatus(){var e=current_status.getAttribute("data-influx-query"),r=current_status.parentNode.parentElement,t=new URL(INFLUXDB_URL);data={db:INFLUXDB_DBNAME,q:e,epoch:"ms"},Object.keys(data).forEach(function(e){t.searchParams.append(e,data[e])}),fetch(t,{type:"GET",dataType:"json"}).then(function(e){return e.json()}).then(function(e){var t=(new Date).getTime(),n=e.results[0].series[0].values[0],e=n[0],n=n[1],e=secondsToString((t-e)/1e3);noInternetAccess||(r.classList.remove(["panel-open","panel-closed"]),"CLOSED"===n?(current_status.innerText="Затворен",r.classList.add(["panel-closed"]),current_status_time.innerHTML="веќе "+e):(current_status.innerText="Отворен",r.classList.add(["panel-open"]),current_status_time.innerHTML="пред "+e))})}function updateDevices(){var e=current_devices.getAttribute("data-influx-query"),n=current_devices.parentNode.parentElement,t=new URL(INFLUXDB_URL);data={db:INFLUXDB_DBNAME,q:e,epoch:"ms"},Object.keys(data).forEach(function(e){t.searchParams.append(e,data[e])}),fetch(t,{type:"GET",dataType:"json"}).then(function(e){return e.json()}).then(function(e){var t=e.results[0].series[0].values[0][1],e="уреди";n.classList.remove(["panel-danger","panel-success"]),n.classList.add(["panel-success"]),t%10==1&&11!==t&&(e="уред"),document.querySelector(".current-devices .value").innerText="вкупно "+t+" "+e,document.querySelector(".current-devices .description").innerText="на мрежата во КИКА"})}function secondsToString(e){var t=Math.round(e/604800),n=Math.round(e/86400),r=Math.round(n-7*t),a=Math.floor(e/3600),o=Math.floor(e%86400%3600/60),c="недели",s="дена",u="дена",d="часа",e="минути";return t%10==1&&11!==t&&(c="недела"),r%10==1&&11!==r&&(u="ден"),n%10==1&&11!==n&&(s="ден"),a%10==1&&11!==a&&(d="час"),o%10==1&&11!==o&&(e="минута"),7<n?0<r?t+" "+c+" и "+r+" "+u:t+" "+c:24<a?n+" "+s:a+" "+d+" и "+o+" "+e}function shuffle(e){for(var t,n,r=e.length;r;t=Math.floor(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);return e}function populateTumblr(n){var e=shuffle(tumblr_api_read.posts),r="";Object.keys(e).forEach(function(e,t){r=e<1?"active":"",document.querySelector(n.selector).find(".carousel-inner").append('<div class="item '+r+'"><img src="'+t["photo-url-500"]+'" ></div>')})}document.addEventListener("DOMContentLoaded",function(e){function t(){document.body.classList.remove("modal-open")}document.addEventListener("keypress",function(e){27==e.keyCode&&(t(),window.location.hash="/")}),document.querySelector(".btn-grafana").addEventListener("click",function(e){window.location="http://grafana.softver.org.mk/"}),document.querySelectorAll(".modal-toggle").forEach(function(e){e.addEventListener("click",function(e){document.body.classList.add("modal-open")})}),document.querySelectorAll(".modal-close").forEach(function(e){e.addEventListener("click",function(e){t()})}),updateStatus(),updateDevices(),-1<window.location.href.indexOf("info-panel")&&(populateTumblr(document.getElementById("tumblr")),populateTumblr(document.getElementById("tumblr2")),document.querySelector(".carousel").carousel({interval:8e3}));window.setInterval(updateStatus,3e5),window.setInterval(updateDevices,3e5)});