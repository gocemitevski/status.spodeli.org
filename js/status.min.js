var INFLUXDB_URL="https://db.softver.org.mk/influxdb/query",INFLUXDB_DBNAME="status",noInternetAccess=!1,current_status=document.querySelector("#status"),current_status_time=document.querySelector("#status-time"),current_devices=document.querySelector("#currentDevices");function updateStatus(){var e=current_status.getAttribute("data-influx-query"),t=current_status.parentNode.parentElement,n=new URL(INFLUXDB_URL);data={db:INFLUXDB_DBNAME,q:e,epoch:"ms"},Object.keys(data).forEach(function(e){n.searchParams.append(e,data[e])}),fetch(n,{type:"GET",dataType:"json"}).then(function(e){return e.json()}).then(function(e){var n=(new Date).getTime(),r=e.results[0].series[0].values[0],a=r[0],o=r[1],c=secondsToString((n-a)/1e3);noInternetAccess||(t.classList.remove(["panel-open","panel-closed"]),"CLOSED"===o?(current_status.innerText="Затворен",t.classList.add(["panel-closed"]),current_status_time.innerHTML="веќе "+c):(current_status.innerText="Отворен",t.classList.add(["panel-open"]),current_status_time.innerHTML="пред "+c))})}function updateDevices(){var e=current_devices.getAttribute("data-influx-query"),t=current_devices.parentNode.parentElement,n=new URL(INFLUXDB_URL);data={db:INFLUXDB_DBNAME,q:e,epoch:"ms"},Object.keys(data).forEach(function(e){n.searchParams.append(e,data[e])}),fetch(n,{type:"GET",dataType:"json"}).then(function(e){return e.json()}).then(function(e){var n=e.results[0].series[0].values[0][1],r="уреди";t.classList.remove(["panel-danger","panel-success"]),t.classList.add(["panel-success"]),n%10==1&&11!==n&&(r="уред"),document.querySelector(".current-devices .value").innerText="вкупно "+n+" "+r,document.querySelector(".current-devices .description").innerText="на мрежата во КИКА"})}function secondsToString(e){var t=Math.round(e/604800),n=Math.round(e/86400),r=Math.round(n-7*t),a=Math.floor(e/3600),o=Math.floor(e%86400%3600/60),c="недели",s="дена",u="дена",d="часа",i="минути";return t%10==1&&11!==t&&(c="недела"),r%10==1&&11!==r&&(u="ден"),n%10==1&&11!==n&&(s="ден"),a%10==1&&11!==a&&(d="час"),o%10==1&&11!==o&&(i="минута"),n>7?r>0?t+" "+c+" и "+r+" "+u:t+" "+c:a>24?n+" "+s:a+" "+d+" и "+o+" "+i}function shuffle(e){for(var t,n,r=e.length;r;t=Math.floor(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);return e}function populateTumblr(e){var t=shuffle(tumblr_api_read.posts),n="";Object.keys(t).forEach(function(t,r){n=t<1?"active":"",document.querySelector(e.selector).find(".carousel-inner").append('<div class="item '+n+'"><img src="'+r["photo-url-500"]+'" ></div>')})}document.addEventListener("DOMContentLoaded",function(e){function t(){document.body.classList.remove("modal-open")}document.addEventListener("keypress",function(e){27==e.keyCode&&(t(),window.location.hash="/")}),document.querySelector(".btn-grafana").addEventListener("click",function(e){window.location="http://grafana.softver.org.mk/"}),document.querySelectorAll(".modal-toggle").forEach(function(e){e.addEventListener("click",function(e){document.body.classList.add("modal-open")})}),document.querySelectorAll(".modal-close").forEach(function(e){e.addEventListener("click",function(e){t()})}),updateStatus(),updateDevices(),window.location.href.indexOf("info-panel")>-1&&(populateTumblr(document.getElementById("tumblr")),populateTumblr(document.getElementById("tumblr2")),document.querySelector(".carousel").carousel({interval:8e3}));window.setInterval(updateStatus,3e5),window.setInterval(updateDevices,3e5)});